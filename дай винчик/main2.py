from classes import *

import vk_api
token = "token"
from vk_api.longpoll import VkLongPoll, VkEventType
vk_session = vk_api.VkApi(token=token)
from random import randint
import sqlite3
longpoll = VkLongPoll(vk_session)
vk = vk_session.get_api()

conn = sqlite3.connect("db.db")
cursor = conn.cursor()
# –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
# –ó–∞–Ω–æ—Å–∏–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
# –ï—Å–ª–∏ —Ç–∞–∫–æ–µ –¥–∞–Ω–Ω–æ–µ –µ—Å—Ç—å - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
# –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ—Å–∏–º –∑–∞–ø–æ–ª–Ω–∏—Ç—å
# –ö–æ–≥–¥–∞ –ø—Ä–∏—à–ª–æ –¥–∞–Ω–Ω–æ–µ - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

array_likes = []
for event in longpoll.listen():
    if event.type == VkEventType.MESSAGE_NEW and event.to_me:	
        count_likes_me = 0
        #–ò–Ω—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ–æ–±—â–µ–Ω–∏–∏
        id_sender = GetMessage(event.message_id)
        #from_id - id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ–º
        from_id = id_sender.user_id()
        #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        send = Send(from_id)
        
        #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–æ–∑–¥–∞–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 
        check_db = Check(from_id)
        
        #–ï—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞, check_db.check() –≤–µ—Ä–Ω–µ—Ç False
        if check_db.check() == False:
            #–ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª
            user = User(from_id)
            #–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
            first_name = user.first_name()
            #–ü–æ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            sex = user.sex()
            #–ö–ª–∞—Å—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            userPhoto = UserPhoto(from_id)
            #–ó–¥–µ—Å—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –∞—Ç—Ç–∞—á–º–µ–Ω—Ç
            user_avatar = userPhoto.result()
            #–í–Ω–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É
            cursor.execute(f"INSERT INTO users (user_id, bot_user_name, sex, activate, avatar) VALUES ('{from_id}', '{first_name}', '{sex}', '1', '{user_avatar}')")
            #–°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ
            conn.commit()
            #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            send.sending(message="–ü—Ä–∏–≤–µ—Ç! –ù–∞—á–∞–ª–æ —Ç–≤–æ–µ–π –∞–Ω–∫–µ—Ç—ã –ø–æ–ª–æ–∂–µ–Ω–æ! –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º –∑–∞–ø–æ–ª–Ω—è—Ç—å –∞–Ω–∫–µ—Ç—É? –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≥–æ—Ä–æ–¥, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ–º –∏—Å–∫–∞—Ç—å —Ç–µ–±–µ –¥—Ä—É–∑–µ–π!")
        else:
            #–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –µ—Å–ª–∏ check_db.check() == True
            #–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç
            #–ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≥–æ—Ä–æ–¥

            #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –Ω–µ—Ö–≤–∞—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
            missing = WhatIsMissing(from_id)
            #–ï—Å–ª–∏ –≥–æ—Ä–æ–¥–∞ –Ω–µ—Ç - city() = False
            if missing.city() == False:
                #–í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –ë–î
                missing.updateCity(event.text)
                #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç
                send.sending(message="–ü—Ä–∏–Ω—è–ª! –ù–∞–ø–∏—à–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç!")
            
            #elif, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω—É–∂–Ω–æ –∏–¥—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
            
            #–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –≤–æ–∑—Ä–∞—Å—Ç
            elif missing.age() == False:
                #–ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç
                missing.updateAge(event.text, from_id)
                #–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å –ø—Ä–æ—Å—å–±–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å —á–∏—Å–ª–æ
            
            #–ï—Å–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            elif missing.description() == False:
            	#–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                missing.updateDescription(event.text)
                #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–Ω—è –∏–ª–∏ –¥–µ–≤—É—à–∫–∏
                send.sending(message = "–ü—Ä–∏–Ω—è–ª, –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–Ω—è—Ç—å, –∫–æ–≥–æ –∏—â–µ–º:\n 1.–î–µ–≤—É—à–∫—É \n2.–ü–∞—Ä–Ω—è\n3.–í—Å—ë —Ä–∞–≤–Ω–æ")

            #–ï—Å–ª–∏ –ø–æ–ª–æ–≤—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
            elif missing.sex_search() == False:
        	    #–û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ
                missing.updateSex_search(event.text)
                #–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –µ—Å–ª–∏ —Ç–∞–º –Ω–µ —Ü–∏—Ñ—Ä—ã, —Ç–æ –±—É–¥–µ–º –ø—Ä–æ—Å–∏—Ç—å –≤–≤–µ—Å—Ç–∏ —Ü–∏—Ñ—Ä—ã        
            elif event.text == '1' or event.text == '2' or event.text == '‚ù§' or event.text == 'üëéüèª':
                #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –≤—ã–≤–æ–¥–∞ –∞–Ω–∫–µ—Ç
                output = Output(from_id)
                #–ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                user = User(from_id)
                #–ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–π –ø–æ–ª
                sex = user.sex()
                #–û–±—ä—è–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è id –Ω—É–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                output.selectAll(sex)
                #–ï—Å–ª–∏ id –ø–æ–ª—É—á–µ–Ω–æ
                get_id = output.getRandomId(sex)
                #–ö–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –ª—é–¥–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è –ª–∞–π–∫–Ω—É–ª–∏
                someoneLikesMe = SomeoneLikesMe(from_id)
                #–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É. –î–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å –º–∞—Å—Å–∏–≤
                array = (someoneLikesMe.returnArray(from_id))
                #–ï—Å–ª–∏ –Ω–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω—É–ª–∏ –º–∞—Å—Å–∏–≤
                print(someoneLikesMe.returnArray(from_id))
                if someoneLikesMe.returnArray(from_id) != False and someoneLikesMe.returnArray(from_id) != []:
                    #–ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –º–∞—Å—Å–∏–≤—É
                    for i in array:
                        #–ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º get_id –ø–æ—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞
                        get_id = array[count_likes_me]
                        #–ù–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ —É–∂–µ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                        count_likes_me += 1
                        #–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 3
                        cursor.execute(f"UPDATE inquiries SET 'status' = '3' WHERE user_2 = '{from_id}' AND user_1 = '{get_id}'")
                        #–°–æ—Ö—Ä–∞–Ω—è–µ–º
                        conn.commit()
                    #–ë–µ—Ä–µ–º –¥–∞–Ω—ã–µ –∏–∑ –±–∞–∑—ã —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º id
                    row = cursor.execute(f"SELECT * FROM users WHERE user_id = '{get_id}'")
                    #–û—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ø–∞–≤—à—É—é—Å—è
                    row = cursor.fetchone()
                    #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if row[11] != "None" or row[11] != None: 
                    	#–ï—Å–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –µ—Å—Ç—å, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π
                        send.sending(message=f"–ê—Ö—Ä–∏–Ω–µ—Ç—å, —Ç—ã –∫–æ–º—É-—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, —Å–º–æ—Ç—Ä–∏:\n {row[2]}, {row[4]}, {row[9]}.\n {row[5]}\n 1. –ù—Ä–∞–≤–∏—Ç—Å—è\n 2.–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è" , attachment = row[11])
                    else:
                    	#–ï—Å–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ—Ç, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                        send.sending(message=f"–ê—Ö—Ä–∏–Ω–µ—Ç—å, —Ç—ã –∫–æ–º—É-—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è, —Å–º–æ—Ç—Ä–∏:\n {row[2]}, {row[4]}, {row[9]}.\n {row[5]}\n 1. –ù—Ä–∞–≤–∏—Ç—Å—è\n 2.–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è")
                else:
                    #–ë–µ—Ä–µ–º –¥–∞–Ω—ã–µ –∏–∑ –±–∞–∑—ã —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º id
                    row = cursor.execute(f"SELECT * FROM users WHERE user_id = '{get_id}'")
                    #–û—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ø–∞–≤—à—É—é—Å—è
                    row = cursor.fetchone()
                    #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if row[11] != "None" or row[11] != None: #–ï—Å–ª–∏ —Ñ–æ—Ç–æ –µ—Å—Ç—å, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å —Ñ–æ—Ç–æ
                        send.sending(message=f"H–∞—à–µ–ª –∫–æ–µ-–∫–æ–≥–æ –¥–ª—è —Ç–µ–±—è, —Å–º–æ—Ç—Ä–∏:\n {row[2]}, {row[4]}, {row[9]}.\n {row[5]}\n 1. –ù—Ä–∞–≤–∏—Ç—Å—è\n 2.–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è", attachment = row[11])
                    else: #–ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ—Ç, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–µ–∑ —Ñ–æ—Ç–æ
                        send.sending(message=f"H–∞—à–µ–ª –∫–æ–µ-–∫–æ–≥–æ –¥–ª—è —Ç–µ–±—è, —Å–º–æ—Ç—Ä–∏:\n {row[2]}, {row[4]}, {row[9]}.\n {row[5]}\n 1. –ù—Ä–∞–≤–∏—Ç—Å—è\n 2.–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è")

                if get_id != "–£–≤—ã" and event.text == '1' or event.text == '2' or event.text == '‚ù§' or event.text == 'üëéüèª':
                    #–î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ —Å id –ª–∞–π–∫–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π id –ª–∞–π–∫–Ω—É—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    array_likes.append(get_id)
                    print(array_likes)
                    #–ï—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ 1, –∑–Ω–∞—á–∏—Ç –Ω–∞–≤–µ—Ä–Ω–æ–µ —á–µ–ª–æ–≤–µ–∫ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è
                    if get_id != "–£–≤—ã" and (event.text == '1' or event.text == '‚ù§'):
                        #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –ø–æ–Ω—Ä–∞–≤–∏–≤—à–µ–≥–æ—Å—è —á–µ–ª–æ–≤–µ–∫–∞    
                        like = Like(from_id)
                        #–î–æ–±–∞–≤–ª—è–µ–º –≤ –±–∞–∑—É —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è
                        like.inquiry(array_likes)
                        #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
                        sympathy = MutualSympathy(from_id)
                        sympathy.selectSympathy()
            else:
                send.sending(message="–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏ –Ω–∞–º —Ü–∏—Ñ—Ä—É –∏–ª–∏ —Å–º–∞–π–ª–∏–∫")
